"62 years and over",
"65 years and over"
)
) %>%
View()
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
)
) %>%
View()
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
)
) %>%
View()
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
)
) %>%
View()
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
)
) %>%
View()
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
category == "HISPANIC OR LATINO AND RACE" & group == "Total population" & !is.na(level) & is.na(restriction) ~ level,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
)
) %>%
View()
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
category == "HISPANIC OR LATINO AND RACE" & group == "Total population" & !is.na(level) & is.na(restriction) ~ level,
category == "HISPANIC OR LATINO AND RACE" & !is.na(group)  & is.na(level) ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
)
) %>%
View()
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
category == "HISPANIC OR LATINO AND RACE" & group == "Total population" & !is.na(level) & is.na(restriction) ~ level,
category == "HISPANIC OR LATINO AND RACE" & !is.na(group)  & is.na(level) ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
),
!is.na(final_level)
) %>%
View()
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
category == "HISPANIC OR LATINO AND RACE" & group == "Total population" & !is.na(level) & is.na(restriction) ~ level,
category == "HISPANIC OR LATINO AND RACE" & !is.na(group)  & is.na(level) ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
),
!is.na(final_level),
!variable %in% c(
"DP05_0023P",
"DP05_0024P",
"DP05_0026P",
"DP05_0027P"
)
) %>%
View()
acs1_dp_labels <-
map_df(2019:2011,
~ load_variables(.x,
"acs1/profile",
cache = TRUE) %>%
mutate(year = .x)
) %>%
rename(variable = name)
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
category == "HISPANIC OR LATINO AND RACE" & group == "Total population" & !is.na(level) & is.na(restriction) ~ level,
category == "HISPANIC OR LATINO AND RACE" & !is.na(group)  & is.na(level) ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
),
!is.na(final_level),
!variable %in% c(
"DP05_0023P",
"DP05_0024P",
"DP05_0026P",
"DP05_0027P"
)
) %>%
select(variable, estimate, moe, year, )
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
category == "HISPANIC OR LATINO AND RACE" & group == "Total population" & !is.na(level) & is.na(restriction) ~ level,
category == "HISPANIC OR LATINO AND RACE" & !is.na(group)  & is.na(level) ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
),
!is.na(final_level),
!variable %in% c(
"DP05_0023P",
"DP05_0024P",
"DP05_0026P",
"DP05_0027P"
)
) %>%
select(variable, estimate, moe, year, category, final_level )
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
category == "HISPANIC OR LATINO AND RACE" & group == "Total population" & !is.na(level) & is.na(restriction) ~ level,
category == "HISPANIC OR LATINO AND RACE" & !is.na(group)  & is.na(level) ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
),
!is.na(final_level),
!variable %in% c(
"DP05_0023P",
"DP05_0024P",
"DP05_0026P",
"DP05_0027P"
)
) %>%
select(variable, estimate, moe, year, category, final_level ) %>% View()
alb_demographi_profile <-
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
category == "HISPANIC OR LATINO AND RACE" & group == "Total population" & !is.na(level) & is.na(restriction) ~ level,
category == "HISPANIC OR LATINO AND RACE" & !is.na(group)  & is.na(level) ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
),
!is.na(final_level),
!variable %in% c(
"DP05_0023P",
"DP05_0024P",
"DP05_0026P",
"DP05_0027P"
)
) %>%
select(variable, estimate, moe, year, category, final_level ) %>% View()
alb_demographi_profile <-
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
category == "HISPANIC OR LATINO AND RACE" & group == "Total population" & !is.na(level) & is.na(restriction) ~ level,
category == "HISPANIC OR LATINO AND RACE" & !is.na(group)  & is.na(level) ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
),
!is.na(final_level),
!variable %in% c(
"DP05_0023P",
"DP05_0024P",
"DP05_0026P",
"DP05_0027P"
)
) %>%
select(variable, estimate, moe, year, category, final_level )
alb_demographi_profile_2011_2019 <-
demographic_tables %>%
left_join(acs1_dp_labels) %>%
separate(label,
c("stat", "category", "group", "level", "restriction", "etc"),
sep = "!!") %>%
filter(stat == "Percent") %>%
filter(!is.na(estimate)) %>%
mutate(
final_level =
case_when(
category == "SEX AND AGE" &
group == "Total population" & !is.na(level) ~ level,
category == "SEX AND AGE"  ~ group,
category == "RACE" & group == "Total population" & level == "One race" & !is.na(restriction) & is.na(etc) ~ restriction,
category == "RACE" & group == "One race" & !is.na(level) & is.na(restriction) ~ level,
category == "RACE" & group == "Total population" & level == "Two or more races" & is.na(restriction)  ~ level,
category == "RACE" & group == "Two or more races" & is.na(level)  ~ group,
category == "HISPANIC OR LATINO AND RACE" & group == "Total population" & !is.na(level) & is.na(restriction) ~ level,
category == "HISPANIC OR LATINO AND RACE" & !is.na(group)  & is.na(level) ~ group,
TRUE ~ NA_character_
)
) %>%
filter(
!final_level %in% c(
"Under 18 years",
"16 years and over",
"18 years and over",
"21 years and over",
"62 years and over",
"65 years and over"
),
!is.na(final_level),
!variable %in% c(
"DP05_0023P",
"DP05_0024P",
"DP05_0026P",
"DP05_0027P"
)
) %>%
select(variable, estimate, moe, year, category, final_level )
