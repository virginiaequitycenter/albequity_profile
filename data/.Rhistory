head(alb_tract$GEOID)
head(tract_snap_per$GEOID)
unique(alb_tract$GEOID)
unique(tract_snap_per$GEOID)
?tracts
unique(tract_snap_per$GEOID) %in% unique(alb_tract$GEOID)
# not sure if it makes more sense to use percent or households
# percent = "S2201_C04_001"
# households = "S2201_C03_001"
tract_snap_per <- tract_snap %>%
filter(variable == "S2201_C04_001") %>%
mutate(GEOID = as.character(GEOID))
# Albemarle tract data
alb_tract <- tracts(state = "VA", county = "003") %>%
mutate(GEOID = as.character(GEOID))
snap_tract <- alb_tract %>%
left_join(tract_snap_per)
View(snap_tract)
snap_tract <- alb_tract %>%
left_join(tract_snap_per, by = "GEOID")
# Map snap use by tract with retailers overlaid
snap_tract_4326 <- sf::st_transform(snap_tract, 4326)
# Pal 3
hlth_colors <- c("#f0dbe2", "#b02c58")
hlth_pal <- function(x) rgb(colorRamp(hlth_colors)(x), maxColorValue = 255)
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 1, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10,
labels = percent
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Percent Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 1, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10,
#labels = percent
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Percent Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 2, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Percent Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
# not sure if it makes more sense to use percent or households
# percent = "S2201_C04_001"
# households = "S2201_C03_001"
tract_snap_per <- tract_snap %>%
filter(variable == "S2201_C03_001")
snap_tract <- alb_tract %>%
left_join(tract_snap_per, by = "GEOID")
# Map snap use by tract with retailers overlaid
snap_tract_4326 <- sf::st_transform(snap_tract, 4326)
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 2, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Percent Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 2, alpha = 1/2, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Percent Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
# lat/lon query
full_path <- "https://services1.arcgis.com/RLQu0rK7h4kbsBq5/arcgis/rest/services/Store_Locations/FeatureServer/0/query?where=Longitude%20%3E%3D%20-78.83887%20AND%20Longitude%20%3C%3D%20-78.20938%20AND%20Latitude%20%3E%3D%2037.72264%20AND%20Latitude%20%3C%3D%2038.27793&outFields=*&outSR=4326&f=json"
# Retrieve data
stores_json <- fromJSON(full_path)
# Extract data frame from list
stores <- stores_json$features$attributes
# make it an SF object
stores_4326 <- st_as_sf(stores,
coords = c("Longitude", "Latitude"),
crs = 4326)
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 2, alpha = 1/2, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Percent Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
# Pal 3
hlth_colors <- c("#f0dbe2", "#b02c58")
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 2, alpha = 1/2, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Number of Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
hlth_colors <- c("#dfdcce", "#c23617")
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 2, alpha = 1/2, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Number of Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
hlth_colors <- c("#b1c5be", "#106449")
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 2, alpha = 1/2, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Number of Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 1, alpha = 1/2, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Number of Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
snap_map <-
ggplot(snap_tract_4326) +
geom_sf(aes(fill = estimate), color = "black") +
geom_sf(data = stores_4326, size = 1, shape = 21, fill = "darkblue") +
scale_fill_steps(
low = educ_colors[1],
high = educ_colors[2],
space = "Lab",
na.value = "grey50",
guide = "coloursteps",
aesthetics = "fill",
n.breaks = 10
) +
theme_void() +
guides(fill =
guide_colourbar(title.position="top", title.hjust = 0.5,
barwidth = 20)
) +
labs(fill = "Number of Housholds Receiving SNAP Benefits") +
annotation_scale(location = "br", width_hint = 0.25) +
annotation_north_arrow(location = "br",
which_north = "true",
pad_x = unit(0.0, "in"),
pad_y = unit(0.5, "in"),
style = north_arrow_minimal(
line_width = 1,
line_col = "black",
fill = "black",
text_col = "black",
text_family = "",
text_face = NULL,
text_size = 0
)) +
theme(
legend.position = "top",
legend.title = element_text(),
panel.border = element_rect(color  = "black",
fill = NA,
size = 1),
plot.margin = margin(l =  .1, r = .1, t = 1, b =1, "cm")
)
snap_map
